<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <title>PointGame</title>
</head>
<body>

    <div class="game-place">
        <table class="game-table">
            <tr>
              <td class="row-title-up" id="card-first">First</td>
              <td class="row-title-up" id="card-second">Second</td>
              <td class="row-title-up" id="card-third">Third</td>
              <td class="row-title-up" id="card-fourth">Fourth</td>
            </tr>
            <tr>
              <td class="row-title-down"><input type="radio" name="card" id="radio-num-1"></td>
              <td class="row-title-down"><input type="radio" name="card" id="radio-num-2"></td>
              <td class="row-title-down"><input type="radio" name="card" id="radio-num-3"></td>
              <td class="row-title-down"><input type="radio" name="card" id="radio-num-4"></td>
            </tr>
        </table>
    </div>
    
    <button class="game-button" id="start-game">시작</button>
    <form action="/point" method="POST">
    <button class="game-button" id="select-card" type="submit">뒤집기</button>
    <input class="result-area" id="card-result" value="" readonly=""><p></p>
    <input class="result-area" id="user-point" value="<%= userpoint.user_point %>" readonly="" name="getpoint"> : 니 포인트
    </form>
    
</body>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
<script>
    var TextBoxCard = document.getElementById("card-result")
    var TextBoxPoint = document.getElementById("user-point")
    var CardValue = [0, 0, 0, 0]
    var CardResult = []
    var Point = TextBoxPoint.value
    var GameStatus = false
    

    // =================== 확률표 ============================
    // 시작 시 100포인트 차감
    // N = 45 (56~100) +20
    // R = 35 (21~55) +45
    // SR = 15 (6~20) +200
    // UR = 5 (1~5) +400
    // 기댓값 : (0.45*20)+(0.35*45)+(0.15*200)+(0.05*400) = 74.75


    const GameStart = document.querySelector("#start-game"); //아이디선택자 나중에 대입
    GameStart.addEventListener("click", gameStart)
   
    function gameStart(){
        console.log('click')
        if (GameStatus == false && Point >= 100)
        {
            GameStatus = true
            Point -= 100
            TextBoxPoint.value = Point
            for(var i = 0; i < CardValue.length; i++)
            {
                CardValue[i] = Math.floor(Math.random() * 100) + 1
                console.log(CardValue[i])
            }
            TextBoxCard.value = '카드를 1장 골라주세요'
        }
        else if (GameStatus == false && Point < 100){
            alert("포인트가 부족합니다.")
        }
        else{
            alert("게임이 진행중입니다.")
        }
        
    }

    const SelectCard = document.querySelector("#select-card"); //아이디선택자 나중에 대입
    SelectCard.addEventListener("click", selectCard)

    function selectCard(){
        if(GameStatus == true)
        {
            valueCheck()
            gameResult()
            console.log('End')
            GameStatus = false
        }
        else
        alert("게임을 시작해주세요")
    }

    function valueCheck(){
        for(var i = 0; i < CardValue.length; i++)
        {
            if(CardValue[i] > 0 && CardValue[i] <= 5){
                CardResult[i] = "UR"
            }
            else if(CardValue[i] > 5 && CardValue[i] <= 20){
                CardResult[i] = "SR"
            }
            else if(CardValue[i] > 20 && CardValue[i] <= 55){
                CardResult[i] = "R"
            }
            else if(CardValue[i] > 55 && CardValue[i] <= 100){
                CardResult[i] = "N"
            }
        }
        
    }

    function gameResult(){
        var checkArray = document.getElementsByName("card")

        for(var i = 0; i < CardValue.length; i++)
        {
            if (checkArray[i].checked){

                calculatePoint(i)
                TextBoxCard.value = CardResult[i]
                TextBoxPoint.value = Point
                console.log(CardResult[i])
                break
            }
        }
    }

    function calculatePoint(i){
        if (CardResult[i] ==  'N'){
            Point += 20
        }
        else if (CardResult[i] ==  'R'){
            Point += 45
        }
        else if (CardResult[i] ==  'SR'){
            Point += 200
        }
        else if (CardResult[i] ==  'UR'){
            Point += 400
        }
    }
</script>
</html>